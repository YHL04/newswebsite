{% load static %}
<!DOCTYPE html>
<link rel="stylesheet" href="{% static 'style.css' %}">
<link rel="stylesheet" href="{% static 'button.css' %}">
<link rel="stylesheet" href="{% static 'coffee.css' %}">
<link rel="stylesheet" href="{% static 'form.css' %}">
<link rel="stylesheet" href="{% static 'like.css' %}">
<link rel="stylesheet" href="{% static 'navbar.css' %}">
<link rel="stylesheet" href="{% static 'category.css' %}">


<html>

<ul>
    <li><a href="{% url 'index' %}">Main</a></li>
    <li><a href="{% url 'about' %}">About</a></li>
</ul>

<head>
    <title>AI Papers</title>
</head>

<body>

<h1>Daily AI News</h1>

<p>Discover the most recent AI papers ranked by algorithm. <b>:)</b></p>

<div class="extra-row">
</div>

<div class="calendar-row">
    {% if next %}
    <button class="arrow-right" onclick="location.href='/{{ next_date }}'"></button>
    {% else %}
    <button class="arrow-empty" onclick="location.href='/{{ curr_date }}'"></button>
    {% endif %}
    <div class="calendar">
        <p class="calendar-month">{{ month }}</p>
        <p class="calendar-day">{{ day }}</p>
    </div>
    <button class="arrow-left" onclick="location.href='/{{ prev_date }}'"></button>

    <div class="category-group">
    {% if category == "none" %}
    <button class="category-selected" onclick="location.href='/{{ curr_date }}'"><b class="category-text-selected">All</b></button>
    {% else %}
    <button class="category" onclick="location.href='/{{ curr_date }}'"><b class="category-text">All</b></button>
    {% endif %}

    {% if category == "transformer" %}
    <button class="category-selected" onclick="location.href='/{{ curr_date }}/transformer'"><b class="category-text-selected">Transformer</b></button>
    {% else %}
    <button class="category" onclick="location.href='/{{ curr_date }}/transformer'"><b class="category-text">Transformer</b></button>
    {% endif %}

    {% if category == "diffusion" %}
    <button class="category-selected" onclick="location.href='/{{ curr_date }}/diffusion'"><b class="category-text-selected">Diffusion</b></button>
    {% else %}
    <button class="category" onclick="location.href='/{{ curr_date }}/diffusion'"><b class="category-text">Diffusion</b></button>
    {% endif %}

    {% if category == "reinforcement" %}
    <button class="category-selected" onclick="location.href='/{{ curr_date }}/reinforcement'"><b class="category-text-selected">Reinforcement Learning</b></button>
    {% else %}
    <button class="category" onclick="location.href='/{{ curr_date }}/reinforcement'"><b class="category-text">Reinforcement Learning</b></button>
    {% endif %}

    {% if category == "other" %}
    <button class="category-selected" onclick="location.href='/{{ curr_date }}/other'"><b class="category-text-selected">Other</b></button>
    {% else %}
    <button class="category" onclick="location.href='/{{ curr_date }}/other'"><b class="category-text">Other</b></button>
    {% endif %}
    </div>

</div>

<div class="grid-container">
    {% for news in news_data %}
    <div class="grid-item">
        <h2 class="grid-set-color">{{ news.title }}</h2>

        <div class="grid-info"><p class="grid-set-color"><b class="grid-info-text">{{ news.date }}</b></p></div>

            <div class="grid-info">
                <button id="{{ news.id }}" data-url="{% url 'post_like' %}" class="likebtn">Like</button>
            </div>

        <script>
            $(document).ready(function () {
                $(".likebtn").click(function (event) {
                    event.preventDefault();
                    var ansid = $(this).attr('id');
                    console.log(ansid)
                    $.ajax({
                        url: $(this).data('url'),
                        type: 'POST',
                        data: {
                            'post_id': ansid,
                            'csrfmiddlewaretoken': "{{ csrf_token }}",
                            'action': 'post'
                        },
                        success: function (response) {
                            $('#like_count' + ansid).text(response['total_likes']);
                            console.log(response)
                            if (response['flag']) {
                                $('#' + ansid).addClass('text-danger');
                            } else {
                                $('#' + ansid).removeClass('text-danger');
                            }
                        },
                        error: function (rs, e) {
                            console.log(rs.response)
                        }
                    });
                });
            });
        </script>


        <div class="grid-info"><p class="grid-set-color"><b class="grid-info-text">Relevance {{ news.citation_rank }}</b></p></div>

        <p class="grid-paragraphs">{{ news.text }}</p>
        <button class="button-17" onclick="window.open('{{ news.link }}','_blank')">
                arXiv
        </button>
    </div>
    {% endfor %}
</div>

</body>

</html>
